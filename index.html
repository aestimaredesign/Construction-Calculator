<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Construction Estimating Calculator</title>
  <style>
    :root {
      --border: #d0d7de;
      --muted: #f6f8fa;
      --ink: #0f172a;
      --ink-soft: #475569;
      --brand: #2563eb;
    }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--ink); margin: 0; }
    .calc-wrap { max-width: 1200px; margin: 0 auto; padding: 12px; }
    .header {
      display: flex; flex-wrap: wrap; align-items: center; gap: 10px;
      justify-content: space-between; margin-bottom: 12px;
    }
    .title { font-size: 1.4rem; font-weight: 700; }
    .controls { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    select, button, input[type="text"], input[type="date"] {
      border: 1px solid var(--border); background: white; padding: 6px 10px; border-radius: 8px; font-size: 14px;
      box-sizing: border-box; width: 100%; max-width: 100%;
    }
    input[type="date"] {
      padding-right: 40px; appearance: none; -webkit-appearance: none; -moz-appearance: none; position: relative;
    }
    input[type="date"]::-webkit-calendar-picker-indicator { padding: 0; margin: 0; width: 20px; height: 20px; cursor: pointer; }
    input[type="date"]::-moz-calendar-picker-indicator { padding: 0; margin: 0; width: 20px; height: 20px; }
    .tabs { display: flex; flex-wrap: wrap; gap: 6px; margin: 10px 0 14px; }
    .tab {
      border: 1px solid var(--border); padding: 8px 10px; border-radius: 10px; background: var(--muted);
      cursor: pointer; font-size: 14px; user-select: none;
    }
    .tab.active { background: #e5efff; border-color: #b6ccff; color: #0b3aa3; font-weight: 700; }
    .panel { display: none; border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
    .panel.active { display: block; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { border: 1px solid var(--border); padding: 6px 8px; vertical-align: middle; }
    th { background: var(--muted); text-align: left; font-weight: 700; }
    td input[type="number"], td input[type="text"] {
      width: 100%; box-sizing: border-box; padding: 6px; border-radius: 6px; border: 1px solid var(--border);
    }
    td select { width: 100%; padding: 6px; border-radius: 6px; border: 1px solid var(--border); }
    .row-total, .mat-cost, .lab-cost { text-align: right; white-space: nowrap; }
    .panel-footer { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-top: 10px; }
    .btn { background: var(--brand); color: white; border: 1px solid var(--brand); padding: 8px 12px; border-radius: 10px; cursor: pointer; }
    .btn.secondary { background: white; color: var(--ink); border: 1px solid var(--border); }
    .discipline-total { font-weight: 700; }
    .grand { margin-top: 14px; padding: 12px; background: #fff7ed; border: 1px solid #fed7aa; border-radius: 12px; }
    .grand .label { color: #9a3412; font-weight: 700; }
    .grand .amount { font-weight: 800; font-size: 1.1rem; }
    .hint { color: var(--ink-soft); font-size: 12px; }
    .project-info { margin-bottom: 20px; border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
    .project-info h2 { font-size: 1.2rem; margin: 0 0 12px; }
    .project-info .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
    .project-info label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 4px; }
    .project-info input { width: 100%; box-sizing: border-box; overflow: hidden; }
    @media (max-width: 600px) {
      .project-info .form-grid { grid-template-columns: 1fr; }
      input[type="date"] { padding-right: 30px; }
    }
    .indent-1 { padding-left: 20px; }
    .indent-2 { padding-left: 40px; }
    .btn-row { display: flex; gap: 4px; }
  </style>
</head>
<body>
  <div class="calc-wrap" id="calcRoot">
    <section class="project-info">
      <h2>Project Information</h2>
      <div class="form-grid">
        <div>
          <label for="projectName">Project Name</label>
          <input type="text" id="projectName" placeholder="Enter project name" required />
        </div>
        <div>
          <label for="clientName">Client Name</label>
          <input type="text" id="clientName" placeholder="Enter client name" required />
        </div>
        <div>
          <label for="companyName">Company Name</label>
          <input type="text" id="companyName" placeholder="Enter company name" required />
        </div>
        <div>
          <label for="projectLocation">Project Location</label>
          <input type="text" id="projectLocation" placeholder="Enter project location" required />
        </div>
        <div>
          <label for="projectDate">Date</label>
          <input type="date" id="projectDate" required />
        </div>
        <div>
          <label for="preparedBy">Prepared By</label>
          <input type="text" id="preparedBy" placeholder="Enter your name" required />
        </div>
      </div>
    </section>

    <div class="header">
      <div class="title">Construction Estimating Calculator</div>
      <div class="controls">
        <label for="currencySel" class="hint">Currency:</label>
        <select id="currencySel" aria-label="Currency">
          <option value="PHP" selected>PHP – Philippine Peso (₱)</option>
          <option value="USD">USD – US Dollar ($)</option>
          <option value="EUR">EUR – Euro (€)</option>
          <option value="SGD">SGD – Singapore Dollar (S$)</option>
          <option value="AUD">AUD – Australian Dollar (A$)</option>
          <option value="JPY">JPY – Japanese Yen (¥)</option>
          <option value="GBP">GBP – British Pound (£)</option>
        </select>
        <span class="hint">Enter Qty + Unit Costs (Material & Labor). Totals auto-calculate.</span>
      </div>
    </div>

    <div class="tabs" id="tabs"></div>
    <div id="panels"></div>

    <div class="grand" role="status" aria-live="polite">
      <div class="label">Grand Total</div>
      <div class="amount"><span id="grandSymbol">₱</span><span id="grandTotal">0.00</span></div>
    </div>
    <div style="margin-top: 20px;">
      <button class="btn" onclick="exportToXLSX()">Export to XLSX</button>
      <button class="btn secondary" onclick="exportToPDF()">Download PDF</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <script>
    (function () {
      const scopes = {
        "Civil-Structural Works": [
          { name: "Site Clearing & Grubbing", unit: "sq.m" },
          { name: "Excavation", unit: "cu.m" },
          { name: "Hauling of Excavated Materials", unit: "cu.m" },
          { name: "Backfilling & Compaction", unit: "cu.m" },
          { name: "Grading & Leveling", unit: "sq.m" },
          { name: "Formwork & Scaffolding", unit: "sq.m" },
          { name: "Rebars", unit: "kg" }, // Removed "Fabrication & Installation"
          { name: "Structural Steel Works", unit: "lump sum" }, // Moved here, no indent
          { name: "Concrete Pouring – Foundations", unit: "cu.m" },
          { name: "Concrete Pouring – Columns/Beams/Slabs", unit: "cu.m" },
          { name: "Masonry Wall Construction", unit: "sq.m" },
          { name: "Lintel/Sill Beams", unit: "linear m" },
          { name: "Perimeter Fence / Retaining Wall", unit: "linear m" },
          { name: "Drainage & Culverts", unit: "linear m" },
          { name: "Septic Tank Construction", unit: "cu.m" }
        ],
        "Architectural Works": [
          { name: "Wall Plastering – Interior", unit: "sq.m" },
          { name: "Wall Plastering – Exterior", unit: "sq.m" },
          { name: "Floor Screeding / Leveling", unit: "sq.m" },
          { name: "Floor Tiling – Ceramic", unit: "sq.m" },
          { name: "Wall Tiling – Ceramic", unit: "sq.m" },
          { name: "Ceiling – Gypsum Board", unit: "sq.m" },
          { name: "Ceiling – PVC / Metal", unit: "sq.m" },
          { name: "Painting – Interior Walls", unit: "sq.m" },
          { name: "Painting – Exterior Walls", unit: "sq.m" },
          { name: "Door Installation – Wood", unit: "unit" },
          { name: "Window Installation – Aluminum/Glass", unit: "unit" },
          { name: "Partition – Gypsum Board", unit: "sq.m" },
          { name: "Cabinetry & Millwork", unit: "unit" },
          { name: "Waterproofing – Wet Areas", unit: "sq.m" }
        ],
        "Plumbing and Sanitary Works": [
          { name: "Cold Waterline – PPR/PEX/PVC", unit: "linear m" },
          { name: "Hot Waterline – PPR/PEX", unit: "linear m" },
          { name: "Sewer Line – uPVC", unit: "linear m" },
          { name: "Storm Drain Line", unit: "linear m" },
          { name: "Lavatory Installation", unit: "unit" },
          { name: "Water Closet Installation", unit: "unit" },
          { name: "Kitchen Sink Installation", unit: "unit" },
          { name: "Floor Drain Installation", unit: "unit" },
          { name: "Water Tank Installation", unit: "unit" },
          { name: "Grease Trap Installation", unit: "unit" },
          { name: "Septic Tank Installation", unit: "unit" }
        ],
        "Electrical Works": [
          { name: "Main Panel / Subpanel Installation", unit: "unit" },
          { name: "Conduit Laying – PVC/EMT", unit: "linear m" },
          { name: "Wiring & Cabling – Power", unit: "linear m" },
          { name: "Wiring & Cabling – Lighting", unit: "linear m" },
          { name: "Lighting Fixtures – LED", unit: "unit" },
          { name: "Power Outlets", unit: "unit" },
          { name: "Light Switches", unit: "unit" },
          { name: "Circuit Breakers", unit: "unit" },
          { name: "Grounding & Earthing", unit: "lump sum" },
          { name: "Testing & Commissioning", unit: "lump sum" }
        ],
        "Auxiliary Works": [
          { name: "CCTV – Cameras", unit: "unit" },
          { name: "CCTV – NVR/DVR", unit: "unit" },
          { name: "Fire Alarm Control Panel", unit: "unit" },
          { name: "Fire Alarm Device Wiring", unit: "linear m" },
          { name: "Data Cabling – Cat5e/Cat6", unit: "linear m" },
          { name: "Telephone Cabling", unit: "linear m" },
          { name: "Access Control System", unit: "unit" },
          { name: "PA/BGM Speakers", unit: "unit" },
          { name: "Intercom System", unit: "unit" },
          { name: "Wi-Fi Access Points", unit: "unit" }
        ],
        "Fire Protection Works": [
          { name: "Sprinkler – Main Piping", unit: "linear m" },
          { name: "Sprinkler Heads Installation", unit: "unit" },
          { name: "Standpipe / Hydrant Piping", unit: "linear m" },
          { name: "Fire Hose Cabinet", unit: "unit" },
          { name: "Fire Extinguishers", unit: "unit" },
          { name: "Smoke / Heat Detectors", unit: "unit" },
          { name: "Fire Pump Set", unit: "unit" },
          { name: "Testing & Commissioning", unit: "lump sum" }
        ],
        "Mechanical Works": [
          { name: "HVAC Ducting – Fabrication", unit: "sq.m" },
          { name: "HVAC Ducting – Installation", unit: "linear m" },
          { name: "Split Type AC Installation", unit: "unit" },
          { name: "Package/VRF System Installation", unit: "unit" },
          { name: "Exhaust/Ventilation Fans", unit: "unit" },
          { name: "Chilled Water Piping", unit: "linear m" },
          { name: "Air Balancing & Testing", unit: "lump sum" }
        ]
      };

      const currencyMap = {
        PHP: { symbol: "₱", dec: 2 },
        USD: { symbol: "$", dec: 2 },
        EUR: { symbol: "€", dec: 2 },
        SGD: { symbol: "S$", dec: 2 },
        AUD: { symbol: "A$", dec: 2 },
        JPY: { symbol: "¥", dec: 0 },
        GBP: { symbol: "£", dec: 2 }
      };
      let currentCurrency = "PHP";

      const $ = (sel, ctx = document) => ctx.querySelector(sel);
      const $$ = (sel, ctx = document) => Array.from(ctx.querySelectorAll(sel));

      const tabsEl = $("#tabs");
      const panelsEl = $("#panels");
      const grandTotalEl = $("#grandTotal");
      const grandSymbolEl = $("#grandSymbol");
      const currencySel = $("#currencySel");

      function fmt(n, dec = 2) {
        return Number(n).toLocaleString(undefined, { minimumFractionDigits: dec, maximumFractionDigits: dec });
      }

      function currencySymbol() {
        return currencyMap[currentCurrency].symbol;
      }

      function decPlaces() {
        return currencyMap[currentCurrency].dec;
      }

      function createTable(dName, rows) {
        const panel = document.createElement("div");
        panel.className = "panel";
        panel.dataset.discipline = dName;

        const table = document.createElement("table");
        table.innerHTML = `
          <thead>
            <tr>
              <th style="min-width:260px">Scope of Work</th>
              <th style="width:110px">Qty</th>
              <th style="width:100px">Unit</th>
              <th style="width:160px">Unit Cost (Material)</th>
              <th style="width:160px">Unit Cost (Labor)</th>
              <th style="width:140px">Material Cost</th>
              <th style="width:140px">Labor Cost</th>
              <th style="width:140px">Total</th>
              <th style="width:100px">Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        `;
        const tbody = table.querySelector("tbody");

        rows.forEach(scope => {
          const tr = makeRow(scope.name, scope.unit, scope.indent || 0);
          tbody.appendChild(tr);
        });

        const addBtn = document.createElement("button");
        addBtn.className = "btn secondary";
        addBtn.type = "button";
        addBtn.textContent = "+ Add Scope";
        addBtn.addEventListener("click", () => {
          const tr = makeRow("New Scope", "unit");
          tbody.appendChild(tr);
          recalc();
        });

        const totalBox = document.createElement("div");
        totalBox.className = "discipline-total";
        totalBox.innerHTML = `Total for <span>${dName}</span>: <span class="discSymbol">${currencySymbol()}</span><span class="discTotal">0.00</span>`;

        const foot = document.createElement("div");
        foot.className = "panel-footer";
        foot.appendChild(addBtn);
        foot.appendChild(totalBox);

        panel.appendChild(table);
        panel.appendChild(foot);
        return panel;
      }

      function makeRow(scopeText, unit, indentLevel = 0) {
        const tr = document.createElement("tr");
        const indentClass = indentLevel > 0 ? `indent-${indentLevel}` : "";
        tr.innerHTML = `
          <td class="${indentClass}"><input type="text" value="${escapeHtml(scopeText)}" /></td>
          <td><input type="number" min="0" step="any" inputmode="decimal" placeholder="0" /></td>
          <td><select>
            <option value="cu.m" ${unit === "cu.m" ? "selected" : ""}>cu.m</option>
            <option value="sq.m" ${unit === "sq.m" ? "selected" : ""}>sq.m</option>
            <option value="linear m" ${unit === "linear m" ? "selected" : ""}>linear m</option>
            <option value="unit" ${unit === "unit" ? "selected" : ""}>unit</option>
            <option value="kg" ${unit === "kg" ? "selected" : ""}>kg</option>
            <option value="lump sum" ${unit === "lump sum" ? "selected" : ""}>lump sum</option>
          </select></td>
          <td><input type="number" min="0" step="any" inputmode="decimal" placeholder="0.00" /></td>
          <td><input type="number" min="0" step="any" inputmode="decimal" placeholder="0.00" /></td>
          <td class="mat-cost">${currencySymbol()}0.00</td>
          <td class="lab-cost">${currencySymbol()}0.00</td>
          <td class="row-total">${currencySymbol()}0.00</td>
          <td class="btn-row">
            <button class="btn secondary" onclick="addRowAfter(this, ${indentLevel})">Add</button>
            <button class="btn secondary" onclick="deleteRow(this)">Delete</button>
          </td>
        `;
        $$("input, select", tr).forEach(inp => inp.addEventListener("input", recalc));
        return tr;
      }

      function escapeHtml(s) {
        return String(s).replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
      }

      const dNames = Object.keys(scopes);
      dNames.forEach((name, i) => {
        const tab = document.createElement("button");
        tab.type = "button";
        tab.className = "tab" + (i === 0 ? " active" : "");
        tab.textContent = name;
        tab.addEventListener("click", () => activate(name));
        tabsEl.appendChild(tab);

        const panel = createTable(name, scopes[name]);
        if (i === 0) panel.classList.add("active");
        panelsEl.appendChild(panel);
      });

      function activate(name) {
        $$(".tab").forEach(t => t.classList.remove("active"));
        $$(".tab").find(t => t.textContent === name)?.classList.add("active");
        $$(".panel").forEach(p => p.classList.remove("active"));
        $(`.panel[data-discipline="${CSS.escape(name)}"]`)?.classList.add("active");
      }

      function recalc() {
        let grand = 0;
        $$(".panel").forEach(panel => {
          let discTotal = 0;
          const rows = $$("tbody tr", panel);
          rows.forEach(tr => {
            const qty = parseFloat($$("input", tr)[1].value) || 0;
            const ucm = parseFloat($$("input", tr)[2].value) || 0;
            const ucl = parseFloat($$("input", tr)[3].value) || 0;
            const mat = qty * ucm;
            const lab = qty * ucl;
            const tot = mat + lab;
            $(".mat-cost", tr).textContent = currencySymbol() + fmt(mat, decPlaces());
            $(".lab-cost", tr).textContent = currencySymbol() + fmt(lab, decPlaces());
            $(".row-total", tr).textContent = currencySymbol() + fmt(tot, decPlaces());
            discTotal += tot;
          });
          panel.querySelector(".discSymbol").textContent = currencySymbol();
          panel.querySelector(".discTotal").textContent = fmt(discTotal, decPlaces());
          grand += discTotal;
        });
        grandSymbolEl.textContent = currencySymbol();
        grandTotalEl.textContent = fmt(grand, decPlaces());
      }

      currencySel.addEventListener("change", () => {
        currentCurrency = currencySel.value;
        recalc();
      });

      $("#projectDate").value = new Date().toISOString().split("T")[0];

      window.deleteRow = function(btn) {
        const tr = btn.closest("tr");
        if (tr) {
          tr.remove();
          recalc();
        }
      };

      window.addRowAfter = function(btn, currentIndent) {
        const tr = btn.closest("tr");
        const tbody = tr.closest("tbody");
        if (!tr || !tbody) {
          console.error("Invalid row or tbody element");
          return;
        }
        const isSubtask = confirm("Add as Subtask?");
        const indent = isSubtask ? Math.min(currentIndent + 1, 2) : currentIndent;
        const newRow = makeRow("New Scope", "unit", indent);
        tbody.insertBefore(newRow, tr.nextSibling);
        newRow.className = indent > 0 ? `indent-${indent}` : "";
        console.log(`Added row with indent level: ${indent}`);
        recalc();
      };

      window.exportToXLSX = function() {
        console.log("Export to XLSX started");
        if (typeof XLSX === 'undefined') {
          console.error("SheetJS not loaded");
          alert("XLSX export failed: SheetJS library not available.");
          return;
        }
        const wb = XLSX.utils.book_new();
        const projectInfo = {
          "Project Name": $("#projectName").value || "N/A",
          "Client Name": $("#clientName").value || "N/A",
          "Company Name": $("#companyName").value || "N/A",
          "Project Location": $("#projectLocation").value || "N/A",
          "Date": $("#projectDate").value || "N/A",
          "Prepared By": $("#preparedBy").value || "N/A"
        };
        const coverData = [
          ["Construction Estimating Calculator"],
          [], ...Object.entries(projectInfo).map(([key, value]) => [key, value]),
          [], ["Currency", currencySel.options[currencySel.selectedIndex].text]
        ];
        const coverSheet = XLSX.utils.aoa_to_sheet(coverData);
        XLSX.utils.book_append_sheet(wb, coverSheet, "Project Info");

        $$(".panel").forEach((panel, index) => {
          const wsData = [["Scope of Work", "Qty", "Unit", "Unit Cost (Material)", "Unit Cost (Labor)", "Material Cost", "Labor Cost", "Total"]];
          $$("tbody tr", panel).forEach(tr => {
            const scope = $$("input", tr)[0].value || "N/A";
            const qty = parseFloat($$("input", tr)[1].value) || 0;
            const unit = $$("select", tr)[0].value || "N/A";
            const ucm = parseFloat($$("input", tr)[2].value) || 0;
            const ucl = parseFloat($$("input", tr)[3].value) || 0;
            const mat = qty * ucm;
            const lab = qty * ucl;
            const tot = mat + lab;
            wsData.push([scope, qty, unit, ucm.toFixed(decPlaces()), ucl.toFixed(decPlaces()), mat.toFixed(decPlaces()), lab.toFixed(decPlaces()), tot.toFixed(decPlaces())]);
          });
          wsData.push([], ["Total", "", "", "", "", "", "", fmt(parseFloat(panel.querySelector(".discTotal").textContent.replace(/,/g, "")), decPlaces())]);
          const ws = XLSX.utils.aoa_to_sheet(wsData);
          XLSX.utils.book_append_sheet(wb, ws, panel.dataset.discipline);
        });

        const summaryData = [["Grand Total"], [currencySymbol() + grandTotalEl.textContent]];
        const summarySheet = XLSX.utils.aoa_to_sheet(summaryData);
        XLSX.utils.book_append_sheet(wb, summarySheet, "Summary");
        XLSX.writeFile(wb, `construction_estimate_${new Date().toISOString().replace(/[-:T]/g, "").slice(0, 14)}.xlsx`);
        console.log("Export to XLSX completed");
      };

      window.exportToPDF = function() {
        console.log("Export to PDF started");
        if (typeof jspdf === 'undefined' || typeof jspdf.jsPDF === 'undefined') {
          console.error("jsPDF or autoTable not loaded");
          alert("PDF export failed: jsPDF or autoTable library not available.");
          return;
        }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(12);
        doc.text("Construction Estimating Calculator", 10, 10);
        doc.text("Project Information", 10, 20);
        const projectInfo = {
          "Project Name": $("#projectName").value || "N/A",
          "Client Name": $("#clientName").value || "N/A",
          "Company Name": $("#companyName").value || "N/A",
          "Project Location": $("#projectLocation").value || "N/A",
          "Date": $("#projectDate").value || "N/A",
          "Prepared By": $("#preparedBy").value || "N/A"
        };
        let y = 30;
        for (const [key, value] of Object.entries(projectInfo)) {
          doc.text(`${key}: ${value}`, 10, y);
          y += 10;
        }
        doc.text(`Currency: ${currencySel.options[currencySel.selectedIndex].text}`, 10, y);
        y += 20;

        $$(".panel").forEach((panel, index) => {
          doc.addPage();
          doc.text(panel.dataset.discipline, 10, 10);
          const tableData = [["Scope of Work", "Qty", "Unit", "Unit Cost (Material)", "Unit Cost (Labor)", "Material Cost", "Labor Cost", "Total"]];
          $$("tbody tr", panel).forEach(tr => {
            const scopeInput = $$("input", tr)[0];
            const scope = scopeInput.value || "N/A";
            const indentLevel = tr.className.match(/indent-(\d+)/)?.[1] || 0;
            const indentedScope = "  ".repeat(indentLevel) + scope;
            const qty = parseFloat($$("input", tr)[1].value) || 0;
            const unit = $$("select", tr)[0].value || "N/A";
            const ucm = parseFloat($$("input", tr)[2].value) || 0;
            const ucl = parseFloat($$("input", tr)[3].value) || 0;
            const mat = qty * ucm;
            const lab = qty * ucl;
            const tot = mat + lab;
            tableData.push([indentedScope, qty, unit, ucm.toFixed(decPlaces()), ucl.toFixed(decPlaces()), mat.toFixed(decPlaces()), lab.toFixed(decPlaces()), tot.toFixed(decPlaces())]);
          });
          tableData.push([], ["Total", "", "", "", "", "", "", fmt(parseFloat(panel.querySelector(".discTotal").textContent.replace(/,/g, "")), decPlaces())]);
          doc.autoTable({
            startY: 20,
            head: [tableData[0]],
            body: tableData.slice(1),
            theme: 'striped',
            margin: { top: 20 },
            styles: { overflow: 'linebreak' }
          });
          y = doc.lastAutoTable.finalY + 10;
        });

        doc.addPage();
        doc.text("Summary", 10, 10);
        doc.text(`Grand Total: ${currencySymbol() + grandTotalEl.textContent}`, 10, 20);
        doc.save(`construction_estimate_${new Date().toISOString().replace(/[-:T]/g, "").slice(0, 14)}.pdf`);
        console.log("Export to PDF completed");
      };
    })();
  </script>
</body>
</html>
